#!/usr/bin/env node

var program = require('commander');

program
  .usage('')
  .option('-i, --index <url>', 'commit the docker images to this index')
  .option('-a, --app <folder>', 'the folder to build the app from')
 
program.on('--help', function(){
  console.log('  Examples:');
  console.log();
  console.log('    # start viking');
  console.log('    $ viking start');
  console.log();
  console.log();
  console.log();
  process.exit();
});

// parse argv

program.parse(process.argv);

var async = require('async');
var utils = require('component-consoler');
var path = require('path');
var fs = require('fs');
var log = utils.log;

var config = require('../lib/config')();
var Etcd = require('../lib/etcd');

if(!config.network.token){
  utils.fatal('config network.token is required');
}

console.log('');
async.series([
  function(next){
    utils.log('etcd', 'starting');

    var etcd = Etcd(config);

    etcd.on('running', function(){
      utils.log('etcd', 'already running');
    })

    etcd.on('removed', function(){
      utils.log('etcd', 'removed old container');
    })

    etcd.on('started', function(){
      utils.log('etcd', 'running');
    })

    etcd.start(next);
  },

  function(next){
    utils.log('etcd', 'started');
  }
], function(){
  console.log('viking started');
})

//etcdid=$(
/*  
  docker run 
  --name etcd -d -p 4001:4001 -p 7001:7001 -v $QUARRY_ROOT/volumes/core/etcd:/data/db
   coreos/etcd -name quarryhq -addr 0.0.0.0:4001 -peer-addr 0.0.0.0:7001 -data-dir /data/db -snapshotCount 100 -snapshot)
*/