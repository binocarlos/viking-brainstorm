#!/usr/bin/env node
var args = require('minimist')(process.argv, {
  boolean:['seed', 'tail'],
  alias:{
    s:'seed',
    t:'tail'
  }
})

var etcd = require('../lib/bootstrap/etcd')

function start(){
  etcd.start(function(err){
    if(err){
      console.error(err)
      process.exit(1)
    }
    if(args.tail){
      etcd.tail()
    }
  })  
}

function writeToken(done){
  etcd.writeToken(function(err, token){
    if(err){
      console.error(err)
      process.exit(1)
    }
    console.log(token)
    done()
  })
}

function seed(done){
  if(args.seed){
    writeToken(done)
  }
  else{
    done()
  }
}


var cmd = args._[2]

if(cmd=='start'){
  seed(function(){
    start()
  })
}
else if(cmd=='stop'){
  etcd.stop(function(err){
    if(err){
      console.error(err)
      process.exit(1)
    }
  })
}
else if(cmd=='reset'){
  etcd.reset(function(){

  })
}
else if(cmd=='tail'){
  etcd.tail(function(){

  })
}